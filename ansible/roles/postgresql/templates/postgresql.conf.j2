# PostgreSQL Configuration File
# Generated by Ansible - DO NOT EDIT MANUALLY

#------------------------------------------------------------------------------
# CONNECTIONS AND AUTHENTICATION
#------------------------------------------------------------------------------

listen_addresses = '{{ postgresql_listen_addresses }}'
port = {{ postgresql_port }}
max_connections = {{ postgresql_max_connections }}

#------------------------------------------------------------------------------
# RESOURCE USAGE
#------------------------------------------------------------------------------

shared_buffers = {{ postgresql_shared_buffers }}
effective_cache_size = {{ postgresql_effective_cache_size }}
maintenance_work_mem = {{ postgresql_maintenance_work_mem }}
work_mem = {{ postgresql_work_mem }}

#------------------------------------------------------------------------------
# WRITE-AHEAD LOG
#------------------------------------------------------------------------------

wal_level = {{ postgresql_wal_level }}
wal_buffers = {{ postgresql_wal_buffers }}
min_wal_size = {{ postgresql_min_wal_size }}
max_wal_size = {{ postgresql_max_wal_size }}
checkpoint_completion_target = {{ postgresql_checkpoint_completion_target }}
wal_log_hints = {{ postgresql_wal_log_hints }}

#------------------------------------------------------------------------------
# REPLICATION
#------------------------------------------------------------------------------

max_wal_senders = {{ postgresql_max_wal_senders }}
max_replication_slots = {{ postgresql_max_replication_slots }}
hot_standby = {{ postgresql_hot_standby }}
hot_standby_feedback = {{ postgresql_hot_standby_feedback }}

#------------------------------------------------------------------------------
# ARCHIVING
#------------------------------------------------------------------------------

archive_mode = {{ postgresql_archive_mode }}
archive_command = '{{ postgresql_archive_command }}'

#------------------------------------------------------------------------------
# QUERY TUNING
#------------------------------------------------------------------------------

random_page_cost = {{ postgresql_random_page_cost }}
effective_io_concurrency = {{ postgresql_effective_io_concurrency }}
default_statistics_target = {{ postgresql_default_statistics_target }}

#------------------------------------------------------------------------------
# REPORTING AND LOGGING
#------------------------------------------------------------------------------

logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_age = 1d
log_rotation_size = 100MB
log_min_duration_statement = 1000
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on
log_temp_files = 0
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

#------------------------------------------------------------------------------
# SHARED LIBRARY PRELOAD
#------------------------------------------------------------------------------

# repmgr will be added after installation by repmgr role
# shared_preload_libraries = 'repmgr'

#------------------------------------------------------------------------------
# DATA DIRECTORY
#------------------------------------------------------------------------------

data_directory = '{{ postgresql_data_dir }}'
hba_file = '{{ postgresql_config_dir }}/pg_hba.conf'
ident_file = '{{ postgresql_config_dir }}/pg_ident.conf'
