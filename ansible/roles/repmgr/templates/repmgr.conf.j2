# repmgr Configuration File
# Generated by Ansible - DO NOT EDIT MANUALLY

#------------------------------------------------------------------------------
# NODE INFORMATION
#------------------------------------------------------------------------------

node_id={{ node_id }}
node_name='{{ inventory_hostname }}'
conninfo='host={{ private_ip }} user={{ repmgr_user }} dbname={{ repmgr_database }} connect_timeout=2'
data_directory='{{ postgresql_data_dir }}'

#------------------------------------------------------------------------------
# LOGGING
#------------------------------------------------------------------------------

log_level=INFO
log_facility=STDERR
log_file='{{ repmgr_log_dir }}/repmgr.log'
log_status_interval=300

#------------------------------------------------------------------------------
# REPLICATION
#------------------------------------------------------------------------------

replication_user='{{ repmgr_user }}'
replication_type=physical

#------------------------------------------------------------------------------
# STANDBY SETTINGS
#------------------------------------------------------------------------------

use_replication_slots=yes
{% if inventory_hostname in groups['pg_standby'] %}
upstream_node_id=1
{% endif %}

#------------------------------------------------------------------------------
# WITNESS SERVER
#------------------------------------------------------------------------------

# witness_sync_interval=15

#------------------------------------------------------------------------------
# FAILOVER SETTINGS (repmgrd)
#------------------------------------------------------------------------------

failover={{ repmgr_failover }}
promote_command='{{ repmgr_promote_command }}'
follow_command='{{ repmgr_follow_command }}'

reconnect_attempts={{ repmgr_reconnect_attempts }}
reconnect_interval={{ repmgr_reconnect_interval }}

# Primary visibility check
primary_visibility_consensus=true
standby_disconnect_on_failover=true

#------------------------------------------------------------------------------
# MONITORING
#------------------------------------------------------------------------------

monitoring_history={{ repmgr_monitoring_history }}
monitor_interval_secs={{ repmgr_monitor_interval_secs }}

#------------------------------------------------------------------------------
# SERVICE COMMANDS
#------------------------------------------------------------------------------

service_start_command='sudo systemctl start postgresql'
service_stop_command='sudo systemctl stop postgresql'
service_restart_command='sudo systemctl restart postgresql'
service_reload_command='sudo systemctl reload postgresql'

#------------------------------------------------------------------------------
# EVENT NOTIFICATIONS
#------------------------------------------------------------------------------

# event_notification_command='/path/to/script.sh %n %e %s "%t" "%d"'
# event_notifications='standby_promote,standby_follow'

#------------------------------------------------------------------------------
# BARMAN (Optional)
#------------------------------------------------------------------------------

# barman_host=''
# barman_server=''
# restore_command=''

#------------------------------------------------------------------------------
# POSTGRESQL BINARIES
#------------------------------------------------------------------------------

pg_bindir='{{ postgresql_bin_dir }}'
